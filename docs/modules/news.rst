.. _modules_news:

*******************
News
*******************

The news module allows users to view the latest articles from the
Harvard Gazette by category, and search for articles using the main
Gazette search engine.  Stories may be shared via email.

The iPhone native app additionally provides the ability to bookmark
stories and share via Twitter or Facebook Connect.

============================
News RSS Feeds
============================

Currently, the news categories are:

* All News (http://news.harvard.edu/gazette/feed/)
* Campus & Community (http://news.harvard.edu/gazette/section/campus-n-community/feed/)
* Arts & Culture (http://news.harvard.edu/gazette/section/arts-n-culture/feed/)
* Science & Health (http://news.harvard.edu/gazette/section/science-n-health/feed/)
* National & World Affairs (http://news.harvard.edu/gazette/section/national-n-world-affairs/feed/)
* Athletics (http://news.harvard.edu/gazette/section/athletics/feed/)

The "Multimedia" category, although available on the Gazette website,
is not currently included.  As stories can belong to multiple
categories, any story that is categorized as a Multimedia story is
removed from feeds that are used on the mobile web and iPhone app.

----------------------
RSS Feed contents
----------------------

RSS feeds are generated by Wordpress.  Each RSS feed, containing 50
items per page, is retrieved and cached our server for a minumum of 5
minutes.

No tags within the RSS <channel> tag (other than <item>) are currently
used by the mobile web and iPhone app.

Tags within the RSS <item> used by the mobile web and iPhone app are:

* ``title``
* ``link``
* ``pubDate``
* ``category``
* ``description``
* ``content:encoded``
* ``image``
* ``harvard:WPID`` (story's unique ID, generated by Wordpress)
* ``harvard:author``
* ``harvard:affiliation``
* ``harvard:featured`` (whether this story can be used as the A1 story in a news category)
* ``harvard:featured_photo`` (URL of the image to use in the A1 position)

Tags prefixed ``harvard:`` are custom tags generated specifically for
this project.

-----------------------
Mobile Web API
-----------------------

^^^^^^^^^^^^
Categories
^^^^^^^^^^^^

A request of the form::

  http://m.harvard.edu/api/
    ?module=news
    &command=channels

retrieves a list of categories from our server.  The response JSON is:

.. code-block:: javascript

  [
    "All News",
    "Campus & Community",
    "Arts & Culture",
    "Science & Health",
    "National & World Affairs",
    "Athletics"
  ]

The position of each category corresponds to the channel ID that
should be used when requesting stories for a particular news category
(see the stories API below).

^^^^^^^^^^^^^^^^
Stories
^^^^^^^^^^^^^^^^

The stories API takes a request of the form::

  http://m.harvard.edu/api/
    ?module=news
    &storyId=49852
    &channel=4

where ``storyId`` (optional) is the ID of the last story retrieved
from the last API request, and ``channel`` (optional) is the category
ID.

RSS feeds are repackaged and returned to the iPhone app 10 stories or
less at a time.  The repackaging process includes the following:

* Each node tagged <item>, starting after the item with the requested
  story ID, is retrieved and added to the queue until there is either
  total of 10 stories, or the end of the feed is reached.  If no story
  ID is requested, the first 10 items are retrieved.

* Stories categorized as "Multimedia" are skipped.

* Inline images are retrieved and cached on our server.  If the image
  is larger taller than 800px or wider than 600px, it is sized down
  proportionally to fit within the maximum allowed dimensions.

* Thumbnail images are checked for dimensions.  If both dimensions are
  1 pixel, indicating a placeholder, the <image> tag is removed from
  the feed.  Our server "caches" the placeholder image as an empty
  file so that the same URL does not need to be checked more than
  once.

^^^^^^^^^^^^^^^^^^
Search
^^^^^^^^^^^^^^^^^^

The search API is similar to the stories API, with a search command
and search term instead of category ID::

  http://m.harvard.edu/api/
    ?module=news
    &command=search
    &q=something+to+search+for
    &storyId=34895

where ``q`` is the search string, and ``storyId`` (optional) is the
last story ID returned from the previous request.  Like the stories
API, our server will return up to 10 stories in a standard RSS feed.

Additionally, we amend the <channel> tag to include an "items"
attribute indicating the total number of results that our server can
return for the requested search term.  Since we only use the first
page of search results, this number can have a maximum of 50, minus
the number of items categorized as "Multimedia".



